<!doctype html>
<html class="default" lang="en" data-base=".">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="IE=edge" />
    <title>json-key-value</title>
    <meta name="description" content="Documentation for json-key-value" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="assets/style.css" />
    <link rel="stylesheet" href="assets/highlight.css" />
    <script defer src="assets/main.js"></script>
    <script async src="assets/icons.js" id="tsd-icons-script"></script>
    <script async src="assets/search.js" id="tsd-search-script"></script>
    <script async src="assets/navigation.js" id="tsd-nav-script"></script>
  </head>
  <body>
    <script>
      document.documentElement.dataset.theme =
        localStorage.getItem("tsd-theme") || "os"
      document.body.style.display = "none"
      setTimeout(
        () =>
          app ? app.showPage() : document.body.style.removeProperty("display"),
        500,
      )
    </script>
    <header class="tsd-page-toolbar">
      <div class="tsd-toolbar-contents container">
        <div class="table-cell" id="tsd-search">
          <div class="field">
            <label
              for="tsd-search-field"
              class="tsd-widget tsd-toolbar-icon search no-caption"
              ><svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                <use href="assets/icons.svg#icon-search"></use></svg></label
            ><input type="text" id="tsd-search-field" aria-label="Search" />
          </div>
          <div class="field"><div id="tsd-toolbar-links"></div></div>
          <ul class="results">
            <li class="state loading">Preparing search index...</li>
            <li class="state failure">The search index is not available</li>
          </ul>
          <a href="index.html" class="title">json-key-value</a>
        </div>
        <div class="table-cell" id="tsd-widgets">
          <a
            href="#"
            class="tsd-widget tsd-toolbar-icon menu no-caption"
            data-toggle="menu"
            aria-label="Menu"
            ><svg width="16" height="16" viewBox="0 0 16 16" fill="none">
              <use href="assets/icons.svg#icon-menu"></use></svg
          ></a>
        </div>
      </div>
    </header>
    <div class="container container-main">
      <div class="col-content">
        <div class="tsd-page-title"><h1>json-key-value</h1></div>
        <div class="tsd-panel tsd-typography">
          <p>
            <img
              src="https://raw.githubusercontent.com/sithmel/json-key-value/main/logo/logo.png"
              alt="JSON key value logo"
            />
          </p>
          <a id="json-key-value" class="tsd-anchor"></a>
          <h1 class="tsd-anchor-link">
            json-key-value<a
              href="#json-key-value"
              aria-label="Permalink"
              class="tsd-anchor-icon"
              ><svg viewBox="0 0 24 24">
                <use href="assets/icons.svg#icon-anchor"></use></svg
            ></a>
          </h1>
          <p>
            json-key-value is a toolkit to work with JSON and JS object as they
            are converted to a sequence to path value pairs (using iterables).
            It enables using filter, map reduce techniques in a way that is
            readable, simpler and efficient.
          </p>
          <p>
            It is minimal (no dependencies) but work well with other libraries.
            It is designed for both server and client.
          </p>
          <a id="the-idea" class="tsd-anchor"></a>
          <h2 class="tsd-anchor-link">
            The idea<a
              href="#the-idea"
              aria-label="Permalink"
              class="tsd-anchor-icon"
              ><svg viewBox="0 0 24 24">
                <use href="assets/icons.svg#icon-anchor"></use></svg
            ></a>
          </h2>
          <p>
            The main idea behind this library is that a JSON can be converted
            into a sequence of &quot;path, value&quot; pairs and can be
            reconstructed from this sequence. This allows to filter and
            transform a big JSON as a stream, without having to load it in
            memory. It also make it easier to work with JSON and JS objects
            using filter/map/reduce.
          </p>
          <p>An example of a sequence is:</p>
          <table>
            <thead>
              <tr>
                <th>Path, Value</th>
                <th>Resulting object</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>[], {}</td>
                <td>{}</td>
              </tr>
              <tr>
                <td>[&quot;name&quot;], &quot;json-key-value&quot;</td>
                <td>{&quot;name&quot;: &quot;json-key-value&quot;}</td>
              </tr>
              <tr>
                <td>[&quot;keywords&quot;], []</td>
                <td>
                  {&quot;name&quot;: &quot;json-key-value&quot;, keywords: []}
                </td>
              </tr>
              <tr>
                <td>[&quot;keywords&quot;, 0], &quot;json&quot;</td>
                <td>
                  {&quot;name&quot;: &quot;json-key-value&quot;, keywords:
                  [&quot;json&quot;]}
                </td>
              </tr>
              <tr>
                <td>[&quot;keywords&quot;, 1], &quot;stream&quot;</td>
                <td>
                  {&quot;name&quot;: &quot;json-key-value&quot;, keywords:
                  [&quot;json&quot;, &quot;stream&quot;]}
                </td>
              </tr>
            </tbody>
          </table>
          <a id="about-the-ordering" class="tsd-anchor"></a>
          <h2 class="tsd-anchor-link">
            About the ordering<a
              href="#about-the-ordering"
              aria-label="Permalink"
              class="tsd-anchor-icon"
              ><svg viewBox="0 0 24 24">
                <use href="assets/icons.svg#icon-anchor"></use></svg
            ></a>
          </h2>
          <p>
            Streaming out JSON requires the &quot;path, value&quot; pairs to be
            emitted in <strong>depth first</strong> order of paths otherwise the
            resulting JSON will be malformed. This is the normal order in which
            data are stored in JSON. Alternatively, it also works if the paths
            are sorted comparing object keys in lexicographic order and array
            indexes from the smallest to the biggest. In this case, the
            structure will be respected, but not necessarily the order the keys
            presents in the original JSON (ES2015 standard introduced the
            concept of key ordering, but it is not respected here).
          </p>
          <a id="example-use-cases" class="tsd-anchor"></a>
          <h2 class="tsd-anchor-link">
            Example use cases<a
              href="#example-use-cases"
              aria-label="Permalink"
              class="tsd-anchor-icon"
              ><svg viewBox="0 0 24 24">
                <use href="assets/icons.svg#icon-anchor"></use></svg
            ></a>
          </h2>
          <a id="rendering-partial-state" class="tsd-anchor"></a>
          <h3 class="tsd-anchor-link">
            Rendering partial state<a
              href="#rendering-partial-state"
              aria-label="Permalink"
              class="tsd-anchor-icon"
              ><svg viewBox="0 0 24 24">
                <use href="assets/icons.svg#icon-anchor"></use></svg
            ></a>
          </h3>
          <p>
            Fetching a big JSON on the browser and render the data in the UI
            while being downloaded (no need to wait for the entire file to be
            downloaded).
          </p>
          <a id="filter-data" class="tsd-anchor"></a>
          <h3 class="tsd-anchor-link">
            Filter data<a
              href="#filter-data"
              aria-label="Permalink"
              class="tsd-anchor-icon"
              ><svg viewBox="0 0 24 24">
                <use href="assets/icons.svg#icon-anchor"></use></svg
            ></a>
          </h3>
          <p>
            Using json-key-value in the backend to fetch a JSON from some source
            (db, file system, network) and filter the data needed. The
            <code>include</code> expression can be passed as query parameter or
            in the body, so that a browser can use a graphql like syntax to
            avoid overfetching. See the <a href="#benchmarks">benchmarks</a>.
          </p>
          <a id="easy-data-manipulation" class="tsd-anchor"></a>
          <h3 class="tsd-anchor-link">
            Easy Data manipulation<a
              href="#easy-data-manipulation"
              aria-label="Permalink"
              class="tsd-anchor-icon"
              ><svg viewBox="0 0 24 24">
                <use href="assets/icons.svg#icon-anchor"></use></svg
            ></a>
          </h3>
          <p>
            Transforming a tree data structure (like a Javascript object) is not
            super convenient. With json-key-value you can simply iterate over
            the sequence and use familiar filter/map/reduce.
          </p>
          <a id="api" class="tsd-anchor"></a>
          <h1 class="tsd-anchor-link">
            API<a href="#api" aria-label="Permalink" class="tsd-anchor-icon"
              ><svg viewBox="0 0 24 24">
                <use href="assets/icons.svg#icon-anchor"></use></svg
            ></a>
          </h1>
          <a id="streamtosequence-1" class="tsd-anchor"></a>
          <h2 class="tsd-anchor-link">
            StreamToSequence<a
              href="#streamtosequence-1"
              aria-label="Permalink"
              class="tsd-anchor-icon"
              ><svg viewBox="0 0 24 24">
                <use href="assets/icons.svg#icon-anchor"></use></svg
            ></a>
          </h2>
          <p>
            StreamToSequence converts chunk of data coming from an iterable in a
            sequence. It is implemented as a
            <a href="https://datatracker.ietf.org/doc/html/rfc8259">rfc8259</a>
            compliant parser. It takes an
            <a
              href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer"
              >array buffer</a
            >
            as input (as
            <a
              href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array"
              >Uint8Array</a
            >), this can come from different implementations of buffers: (<a
              href="https://nodejs.org/api/buffer.html"
              >node buffers</a
            >
            of
            <a href="https://nodejs.org/api/webstreams.html">web streams</a>).
            See the <a href="#examples">examples</a> below!
          </p>
          <p>Let's assume we have this JSON:</p>
          <pre><code class="json"><span class="hl-0">[</span><br/><span class="hl-0">  {</span><span class="hl-1">&quot;firstName&quot;</span><span class="hl-0">: </span><span class="hl-2">&quot;Bruce&quot;</span><span class="hl-0">, </span><span class="hl-1">&quot;lastName&quot;</span><span class="hl-0">: </span><span class="hl-2">&quot;Banner&quot;</span><span class="hl-0">},</span><br/><span class="hl-0">  {</span><span class="hl-1">&quot;firstName&quot;</span><span class="hl-0">: </span><span class="hl-2">&quot;Peter&quot;</span><span class="hl-0">, </span><span class="hl-1">&quot;lastName&quot;</span><span class="hl-0">: </span><span class="hl-2">&quot;Parker&quot;</span><span class="hl-0">},</span><br/><span class="hl-0">  </span><span class="hl-3">...</span><br/><span class="hl-0">]</span>
</code><button type="button">Copy</button></pre>

          <pre><code class="js"><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">StreamToSequence</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;json-key-value&quot;</span><br/><br/><span class="hl-6">const</span><span class="hl-0"> </span><span class="hl-7">parser</span><span class="hl-0"> = </span><span class="hl-6">new</span><span class="hl-0"> </span><span class="hl-8">StreamToSequence</span><span class="hl-0">()</span><br/><span class="hl-5">for</span><span class="hl-0"> </span><span class="hl-8">async</span><span class="hl-0"> (</span><span class="hl-5">const</span><span class="hl-0"> </span><span class="hl-5">chunk</span><span class="hl-0"> </span><span class="hl-6">of</span><span class="hl-0"> </span><span class="hl-5">bufferIterable</span><span class="hl-0">) {</span><br/><span class="hl-0">  </span><span class="hl-4">for</span><span class="hl-0"> (</span><span class="hl-6">const</span><span class="hl-0"> [</span><span class="hl-7">path</span><span class="hl-0">, </span><span class="hl-7">value</span><span class="hl-0">] </span><span class="hl-6">of</span><span class="hl-0"> </span><span class="hl-5">parser</span><span class="hl-0">.</span><span class="hl-8">iter</span><span class="hl-0">(</span><span class="hl-5">chunk</span><span class="hl-0">)) {</span><br/><span class="hl-0">    </span><span class="hl-5">console</span><span class="hl-0">.</span><span class="hl-8">log</span><span class="hl-0">(</span><span class="hl-5">path</span><span class="hl-0">, </span><span class="hl-5">value</span><span class="hl-0">)</span><br/><span class="hl-0">  }</span><br/><span class="hl-0">}</span>
</code><button type="button">Copy</button></pre>

          <p>This will print:</p>
          <pre><code><span class="hl-0">[] []</span><br/><span class="hl-0">[</span><span class="hl-9">0</span><span class="hl-0">] {}</span><br/><span class="hl-0">[</span><span class="hl-9">0</span><span class="hl-0">, </span><span class="hl-2">&quot;firstName&quot;</span><span class="hl-0">] </span><span class="hl-2">&quot;Bruce&quot;</span><br/><span class="hl-0">[</span><span class="hl-9">0</span><span class="hl-0">, </span><span class="hl-2">&quot;lastName&quot;</span><span class="hl-0">] </span><span class="hl-2">&quot;Banner&quot;</span><br/><span class="hl-0">[</span><span class="hl-9">1</span><span class="hl-0">] {}</span><br/><span class="hl-0">[</span><span class="hl-9">1</span><span class="hl-0">, </span><span class="hl-2">&quot;firstName&quot;</span><span class="hl-0">] </span><span class="hl-2">&quot;Peter&quot;</span><br/><span class="hl-0">[</span><span class="hl-9">1</span><span class="hl-0">, </span><span class="hl-2">&quot;lastName&quot;</span><span class="hl-0">] </span><span class="hl-2">&quot;Parker&quot;</span><br/><span class="hl-0">...</span>
</code><button>Copy</button></pre>

          <p>
            <em
              >There is an extremely rare corner case where the parser doesn't
              work as expected: when a json consists in a
              <strong>single number and no trailing spaces</strong>. In that
              case it is necessary to add a trailing space to make it work
              correctly!</em
            >
          </p>
          <p>
            The parser ha a method to check if the JSON was parsed in its
            entirety <code>isFinished</code>. This can be used to verify is the
            JSON file is well formed, after the buffer has been entirely
            consumed.
          </p>
          <a id="partial-parsing" class="tsd-anchor"></a>
          <h3 class="tsd-anchor-link">
            Partial parsing<a
              href="#partial-parsing"
              aria-label="Permalink"
              class="tsd-anchor-icon"
              ><svg viewBox="0 0 24 24">
                <use href="assets/icons.svg#icon-anchor"></use></svg
            ></a>
          </h3>
          <p>
            StreamToSequence takes 2 optional parameters: <em>maxDepth</em> and
            <em>includes</em>.
          </p>
          <p>
            maxDepth is used to group the data over a certain depth together. It
            also allows to considerable increase the speed of the parsing when
            used together with <em>includes</em>.
          </p>
          <p>Here is how it works:</p>
          <p>Let's assume we use the same JSON used above:</p>
          <pre><code class="js"><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">StreamToSequence</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;json-key-value&quot;</span><br/><br/><span class="hl-6">const</span><span class="hl-0"> </span><span class="hl-7">parser</span><span class="hl-0"> = </span><span class="hl-6">new</span><span class="hl-0"> </span><span class="hl-8">StreamToSequence</span><span class="hl-0">({</span><span class="hl-5">maxDepth:</span><span class="hl-0"> </span><span class="hl-9">1</span><span class="hl-0">})</span><br/><span class="hl-5">for</span><span class="hl-0"> </span><span class="hl-8">async</span><span class="hl-0"> (</span><span class="hl-5">const</span><span class="hl-0"> </span><span class="hl-5">chunk</span><span class="hl-0"> </span><span class="hl-6">of</span><span class="hl-0"> </span><span class="hl-5">bufferIterable</span><span class="hl-0">) {</span><br/><span class="hl-0">  </span><span class="hl-4">for</span><span class="hl-0"> (</span><span class="hl-6">const</span><span class="hl-0"> [</span><span class="hl-7">path</span><span class="hl-0">, </span><span class="hl-7">value</span><span class="hl-0">] </span><span class="hl-6">of</span><span class="hl-0"> </span><span class="hl-5">parser</span><span class="hl-0">.</span><span class="hl-8">iter</span><span class="hl-0">(</span><span class="hl-5">chunk</span><span class="hl-0">)) {</span><br/><span class="hl-0">    </span><span class="hl-5">console</span><span class="hl-0">.</span><span class="hl-8">log</span><span class="hl-0">(</span><span class="hl-5">path</span><span class="hl-0">, </span><span class="hl-5">value</span><span class="hl-0">)</span><br/><span class="hl-0">  }</span><br/><span class="hl-0">}</span>
</code><button type="button">Copy</button></pre>

          <p>This will print:</p>
          <pre><code><span class="hl-0">[] []</span><br/><span class="hl-0">[</span><span class="hl-9">0</span><span class="hl-0">] {</span><span class="hl-2">&quot;firstName&quot;</span><span class="hl-0">: </span><span class="hl-2">&quot;Bruce&quot;</span><span class="hl-0">, </span><span class="hl-2">&quot;lastName&quot;</span><span class="hl-0">: </span><span class="hl-2">&quot;Banner&quot;</span><span class="hl-0">}</span><br/><span class="hl-0">[</span><span class="hl-9">1</span><span class="hl-0">] {</span><span class="hl-2">&quot;firstName&quot;</span><span class="hl-0">: </span><span class="hl-2">&quot;Peter&quot;</span><span class="hl-0">, </span><span class="hl-2">&quot;lastName&quot;</span><span class="hl-0">: </span><span class="hl-2">&quot;Parker&quot;</span><span class="hl-0">}</span><br/><span class="hl-0">...</span>
</code><button>Copy</button></pre>

          <p>
            <em>includes</em> allows to select what paths we want to read and
            filter the others. It is much faster then filtering the pairs after
            are emitted because allows stop parsing the stream if no further
            matches are possible. Here is an example (using the same JSON):
          </p>
          <pre><code class="js"><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">StreamToSequence</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;json-key-value&quot;</span><br/><br/><span class="hl-6">const</span><span class="hl-0"> </span><span class="hl-7">parser</span><span class="hl-0"> = </span><span class="hl-6">new</span><span class="hl-0"> </span><span class="hl-8">StreamToSequence</span><span class="hl-0">({</span><span class="hl-5">includes:</span><span class="hl-0"> </span><span class="hl-2">&#39;0 (firstName)&#39;</span><span class="hl-0">})</span><br/><span class="hl-5">for</span><span class="hl-0"> </span><span class="hl-8">async</span><span class="hl-0"> (</span><span class="hl-5">const</span><span class="hl-0"> </span><span class="hl-5">chunk</span><span class="hl-0"> </span><span class="hl-6">of</span><span class="hl-0"> </span><span class="hl-5">bufferIterable</span><span class="hl-0">) {</span><br/><span class="hl-0">  </span><span class="hl-4">for</span><span class="hl-0"> (</span><span class="hl-6">const</span><span class="hl-0"> [</span><span class="hl-7">path</span><span class="hl-0">, </span><span class="hl-7">value</span><span class="hl-0">] </span><span class="hl-6">of</span><span class="hl-0"> </span><span class="hl-5">parser</span><span class="hl-0">.</span><span class="hl-8">iter</span><span class="hl-0">(</span><span class="hl-5">chunk</span><span class="hl-0">)) {</span><br/><span class="hl-0">    </span><span class="hl-5">console</span><span class="hl-0">.</span><span class="hl-8">log</span><span class="hl-0">(</span><span class="hl-5">path</span><span class="hl-0">, </span><span class="hl-5">value</span><span class="hl-0">)</span><br/><span class="hl-0">  }</span><br/><span class="hl-0">}</span>
</code><button type="button">Copy</button></pre>

          <p>With this output:</p>
          <pre><code><span class="hl-0">[</span><span class="hl-9">0</span><span class="hl-0">, </span><span class="hl-2">&quot;firstName&quot;</span><span class="hl-0">] </span><span class="hl-2">&quot;Bruce&quot;</span><br/><span class="hl-0">...</span>
</code><button>Copy</button></pre>

          <p>
            <code>includes</code> is able to figure out whether there are still
            data to extract of we can stop reading from the buffer.
          </p>
          <pre><code class="js"><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">StreamToSequence</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;json-key-value&quot;</span><br/><br/><span class="hl-6">const</span><span class="hl-0"> </span><span class="hl-7">parser</span><span class="hl-0"> = </span><span class="hl-6">new</span><span class="hl-0"> </span><span class="hl-8">StreamToSequence</span><span class="hl-0">({</span><span class="hl-5">includes:</span><span class="hl-0"> </span><span class="hl-2">&#39;0 (firstName)&#39;</span><span class="hl-0">})</span><br/><span class="hl-5">for</span><span class="hl-0"> </span><span class="hl-8">async</span><span class="hl-0"> (</span><span class="hl-5">const</span><span class="hl-0"> </span><span class="hl-5">chunk</span><span class="hl-0"> </span><span class="hl-6">of</span><span class="hl-0"> </span><span class="hl-5">bufferIterable</span><span class="hl-0">) {</span><br/><span class="hl-0">  </span><span class="hl-4">if</span><span class="hl-0"> (</span><span class="hl-5">parser</span><span class="hl-0">.</span><span class="hl-8">isExhausted</span><span class="hl-0">()) </span><span class="hl-4">break</span><span class="hl-0"> </span><span class="hl-10">// no further data to read</span><br/><br/><span class="hl-0">  </span><span class="hl-4">for</span><span class="hl-0"> (</span><span class="hl-6">const</span><span class="hl-0"> [</span><span class="hl-7">path</span><span class="hl-0">, </span><span class="hl-7">value</span><span class="hl-0">] </span><span class="hl-6">of</span><span class="hl-0"> </span><span class="hl-5">parser</span><span class="hl-0">.</span><span class="hl-8">iter</span><span class="hl-0">(</span><span class="hl-5">chunk</span><span class="hl-0">)) {</span><br/><span class="hl-0">    </span><span class="hl-5">console</span><span class="hl-0">.</span><span class="hl-8">log</span><span class="hl-0">(</span><span class="hl-5">path</span><span class="hl-0">, </span><span class="hl-5">value</span><span class="hl-0">)</span><br/><span class="hl-0">  }</span><br/><span class="hl-0">}</span><br/><span class="hl-10">// stop the stream here!</span>
</code><button type="button">Copy</button></pre>

          <p>More about <a href="#includes">includes</a> syntax below!</p>
          <a id="buffer-position" class="tsd-anchor"></a>
          <h3 class="tsd-anchor-link">
            Buffer position<a
              href="#buffer-position"
              aria-label="Permalink"
              class="tsd-anchor-icon"
              ><svg viewBox="0 0 24 24">
                <use href="assets/icons.svg#icon-anchor"></use></svg
            ></a>
          </h3>
          <p>
            The iter method yields 2 extra numbers. They are the starting and
            ending position of the buffer, corresponding to the value that is
            emitting. So for example, with the JSON we used so far:
          </p>
          <pre><code class="js"><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">StreamToSequence</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;json-key-value&quot;</span><br/><br/><span class="hl-6">const</span><span class="hl-0"> </span><span class="hl-7">parser</span><span class="hl-0"> = </span><span class="hl-6">new</span><span class="hl-0"> </span><span class="hl-8">StreamToSequence</span><span class="hl-0">({</span><span class="hl-5">maxDepth:</span><span class="hl-0"> </span><span class="hl-9">1</span><span class="hl-0">})</span><br/><span class="hl-5">for</span><span class="hl-0"> </span><span class="hl-8">async</span><span class="hl-0"> (</span><span class="hl-5">const</span><span class="hl-0"> </span><span class="hl-5">chunk</span><span class="hl-0"> </span><span class="hl-6">of</span><span class="hl-0"> </span><span class="hl-5">bufferIterable</span><span class="hl-0">) {</span><br/><span class="hl-0">  </span><span class="hl-4">for</span><span class="hl-0"> (</span><span class="hl-6">const</span><span class="hl-0"> [</span><span class="hl-7">path</span><span class="hl-0">, </span><span class="hl-7">value</span><span class="hl-0">, </span><span class="hl-7">startPosition</span><span class="hl-0">, </span><span class="hl-7">endPosition</span><span class="hl-0">] </span><span class="hl-6">of</span><span class="hl-0"> </span><span class="hl-5">parser</span><span class="hl-0">.</span><span class="hl-8">iter</span><span class="hl-0">(</span><span class="hl-5">chunk</span><span class="hl-0">)) {</span><br/><span class="hl-0">    </span><span class="hl-5">console</span><span class="hl-0">.</span><span class="hl-8">log</span><span class="hl-0">(</span><span class="hl-5">path</span><span class="hl-0">, </span><span class="hl-5">value</span><span class="hl-0">, </span><span class="hl-5">startPosition</span><span class="hl-0">, </span><span class="hl-5">endPosition</span><span class="hl-0">)</span><br/><span class="hl-0">  }</span><br/><span class="hl-0">}</span>
</code><button type="button">Copy</button></pre>

          <p>This will print:</p>
          <pre><code><span class="hl-0">[] [] </span><span class="hl-9">0</span><span class="hl-0"> </span><span class="hl-9">1</span><br/><span class="hl-0">[</span><span class="hl-9">0</span><span class="hl-0">] {</span><span class="hl-2">&quot;firstName&quot;</span><span class="hl-0">: </span><span class="hl-2">&quot;Bruce&quot;</span><span class="hl-0">, </span><span class="hl-2">&quot;lastName&quot;</span><span class="hl-0">: </span><span class="hl-2">&quot;Banner&quot;</span><span class="hl-0">} </span><span class="hl-9">4</span><span class="hl-0"> </span><span class="hl-9">49</span><br/><span class="hl-0">[</span><span class="hl-9">1</span><span class="hl-0">] {</span><span class="hl-2">&quot;firstName&quot;</span><span class="hl-0">: </span><span class="hl-2">&quot;Peter&quot;</span><span class="hl-0">, </span><span class="hl-2">&quot;lastName&quot;</span><span class="hl-0">: </span><span class="hl-2">&quot;Parker&quot;</span><span class="hl-0">} </span><span class="hl-9">53</span><span class="hl-0"> </span><span class="hl-9">98</span><br/><span class="hl-0">...</span>
</code><button>Copy</button></pre>

          <p>Once the position of a value is known, is possible for example:</p>
          <ul>
            <li>
              to index where the data is in the buffer and access them directly
            </li>
            <li>
              to pause and resume the parsing from that position in the buffer
            </li>
          </ul>
          <p>
            It is possible to resume the parsing using the option
            <code>startingPath</code>. So for example, let's say we want to
            resume reading from &quot;Peter Parker&quot;:
          </p>
          <pre><code class="js"><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">StreamToSequence</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;json-key-value&quot;</span><br/><br/><span class="hl-6">const</span><span class="hl-0"> </span><span class="hl-7">parser</span><span class="hl-0"> = </span><span class="hl-6">new</span><span class="hl-0"> </span><span class="hl-8">StreamToSequence</span><span class="hl-0">({</span><span class="hl-5">maxDepth:</span><span class="hl-0"> </span><span class="hl-9">1</span><span class="hl-0">, </span><span class="hl-5">startingPath:</span><span class="hl-0"> [</span><span class="hl-9">1</span><span class="hl-0">]})</span><br/><span class="hl-10">// bufferIterable MUST start from the byte number 53</span><br/><br/><span class="hl-5">for</span><span class="hl-0"> </span><span class="hl-8">async</span><span class="hl-0"> (</span><span class="hl-5">const</span><span class="hl-0"> </span><span class="hl-5">chunk</span><span class="hl-0"> </span><span class="hl-6">of</span><span class="hl-0"> </span><span class="hl-5">bufferIterable</span><span class="hl-0">) {</span><br/><span class="hl-0">  </span><span class="hl-4">for</span><span class="hl-0"> (</span><span class="hl-6">const</span><span class="hl-0"> [</span><span class="hl-7">path</span><span class="hl-0">, </span><span class="hl-7">value</span><span class="hl-0">, </span><span class="hl-7">startPosition</span><span class="hl-0">, </span><span class="hl-7">endPosition</span><span class="hl-0">] </span><span class="hl-6">of</span><span class="hl-0"> </span><span class="hl-5">parser</span><span class="hl-0">.</span><span class="hl-8">iter</span><span class="hl-0">(</span><span class="hl-5">chunk</span><span class="hl-0">)) {</span><br/><span class="hl-0">    </span><span class="hl-5">console</span><span class="hl-0">.</span><span class="hl-8">log</span><span class="hl-0">(</span><span class="hl-5">path</span><span class="hl-0">, </span><span class="hl-5">value</span><span class="hl-0">, </span><span class="hl-5">startPosition</span><span class="hl-0">, </span><span class="hl-5">endPosition</span><span class="hl-0">)</span><br/><span class="hl-0">  }</span><br/><span class="hl-0">}</span>
</code><button type="button">Copy</button></pre>

          <p>This will print:</p>
          <pre><code><span class="hl-0">[</span><span class="hl-9">1</span><span class="hl-0">] {</span><span class="hl-2">&quot;firstName&quot;</span><span class="hl-0">: </span><span class="hl-2">&quot;Peter&quot;</span><span class="hl-0">, </span><span class="hl-2">&quot;lastName&quot;</span><span class="hl-0">: </span><span class="hl-2">&quot;Parker&quot;</span><span class="hl-0">} </span><span class="hl-9">0</span><span class="hl-0"> </span><span class="hl-9">45</span><br/><span class="hl-0">...</span>
</code><button>Copy</button></pre>

          <p>
            In this case startPosition and endPosition will be relative to the
            buffer starting on byte 53.
          </p>
          <a id="objecttosequence-1" class="tsd-anchor"></a>
          <h2 class="tsd-anchor-link">
            ObjectToSequence<a
              href="#objecttosequence-1"
              aria-label="Permalink"
              class="tsd-anchor-icon"
              ><svg viewBox="0 0 24 24">
                <use href="assets/icons.svg#icon-anchor"></use></svg
            ></a>
          </h2>
          <p>ObjectToSequence transforms a js object into a sequence:</p>
          <pre><code class="js"><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">ObjectToSequence</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;json-key-value&quot;</span><br/><br/><span class="hl-6">const</span><span class="hl-0"> </span><span class="hl-7">parser</span><span class="hl-0"> = </span><span class="hl-6">new</span><span class="hl-0"> </span><span class="hl-8">ObjectToSequence</span><span class="hl-0">()</span><br/><span class="hl-4">for</span><span class="hl-0"> (</span><span class="hl-6">const</span><span class="hl-0"> [</span><span class="hl-7">path</span><span class="hl-0">, </span><span class="hl-7">value</span><span class="hl-0">] </span><span class="hl-6">of</span><span class="hl-0"> </span><span class="hl-5">parser</span><span class="hl-0">.</span><span class="hl-8">iter</span><span class="hl-0">({ </span><span class="hl-5">hello:</span><span class="hl-0"> </span><span class="hl-5">world</span><span class="hl-0"> })) {</span><br/><span class="hl-0">  </span><span class="hl-5">console</span><span class="hl-0">.</span><span class="hl-8">log</span><span class="hl-0">(</span><span class="hl-5">path</span><span class="hl-0">, </span><span class="hl-5">value</span><span class="hl-0">)</span><br/><span class="hl-0">}</span>
</code><button type="button">Copy</button></pre>

          <p>This prints:</p>
          <pre><code class="js"><span class="hl-0">[] {}</span><br/><span class="hl-0">[</span><span class="hl-2">&#39;hello&#39;</span><span class="hl-0">] </span><span class="hl-2">&#39;world&#39;</span>
</code><button type="button">Copy</button></pre>

          <p>
            ObjectToSequence takes 2 optional parameters: <em>maxDepth</em> and
            <em>includes</em>. They works exactly the same as for
            StreamToSequence.
          </p>
          <a id="sequencetoobject-1" class="tsd-anchor"></a>
          <h2 class="tsd-anchor-link">
            SequenceToObject<a
              href="#sequencetoobject-1"
              aria-label="Permalink"
              class="tsd-anchor-icon"
              ><svg viewBox="0 0 24 24">
                <use href="assets/icons.svg#icon-anchor"></use></svg
            ></a>
          </h2>
          <p>SequenceToObject reconstructs an object from a sequence:</p>
          <pre><code class="js"><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">SequenceToObject</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;json-key-value&quot;</span><br/><br/><span class="hl-6">const</span><span class="hl-0"> </span><span class="hl-7">objBuilder</span><span class="hl-0"> = </span><span class="hl-6">new</span><span class="hl-0"> </span><span class="hl-8">SequenceToObject</span><span class="hl-0">()</span><br/><span class="hl-5">objBuilder</span><span class="hl-0">.</span><span class="hl-8">add</span><span class="hl-0">([], {}) </span><span class="hl-10">// build initial object</span><br/><span class="hl-5">objBuilder</span><span class="hl-0">.</span><span class="hl-8">add</span><span class="hl-0">([</span><span class="hl-2">&quot;hello&quot;</span><span class="hl-0">], </span><span class="hl-2">&quot;world&quot;</span><span class="hl-0">)</span><br/><span class="hl-5">objBuilder</span><span class="hl-0">.</span><span class="hl-5">object</span><span class="hl-0"> === { </span><span class="hl-5">hello:</span><span class="hl-0"> </span><span class="hl-2">&quot;world&quot;</span><span class="hl-0"> }</span>
</code><button type="button">Copy</button></pre>

          <p>
            The implementation forgives if &quot;containers&quot; (arrays and
            objects) are omitted
          </p>
          <pre><code class="js"><span class="hl-6">const</span><span class="hl-0"> </span><span class="hl-7">objBuilder</span><span class="hl-0"> = </span><span class="hl-6">new</span><span class="hl-0"> </span><span class="hl-8">SequenceToObject</span><span class="hl-0">()</span><br/><span class="hl-5">objBuilder</span><span class="hl-0">.</span><span class="hl-8">add</span><span class="hl-0">([</span><span class="hl-2">&quot;hello&quot;</span><span class="hl-0">], </span><span class="hl-2">&quot;world&quot;</span><span class="hl-0">)</span><br/><span class="hl-5">objBuilder</span><span class="hl-0">.</span><span class="hl-5">object</span><span class="hl-0"> === { </span><span class="hl-5">hello:</span><span class="hl-0"> </span><span class="hl-2">&quot;world&quot;</span><span class="hl-0"> }</span>
</code><button type="button">Copy</button></pre>

          <p>It also fills empty array positions with nulls:</p>
          <pre><code class="js"><span class="hl-6">const</span><span class="hl-0"> </span><span class="hl-7">objBuilder</span><span class="hl-0"> = </span><span class="hl-6">new</span><span class="hl-0"> </span><span class="hl-8">SequenceToObject</span><span class="hl-0">()</span><br/><span class="hl-5">objBuilder</span><span class="hl-0">.</span><span class="hl-8">add</span><span class="hl-0">([</span><span class="hl-9">2</span><span class="hl-0">], </span><span class="hl-2">&quot;hello world&quot;</span><span class="hl-0">)</span><br/><span class="hl-5">objBuilder</span><span class="hl-0">.</span><span class="hl-5">object</span><span class="hl-0"> === [</span><span class="hl-6">null</span><span class="hl-0">, </span><span class="hl-6">null</span><span class="hl-0">, </span><span class="hl-2">&quot;hello world&quot;</span><span class="hl-0">]</span>
</code><button type="button">Copy</button></pre>

          <p>Unless the options <code>compactArrays</code> is true:</p>
          <pre><code class="js"><span class="hl-6">const</span><span class="hl-0"> </span><span class="hl-7">objBuilder</span><span class="hl-0"> = </span><span class="hl-6">new</span><span class="hl-0"> </span><span class="hl-8">SequenceToObject</span><span class="hl-0">({ </span><span class="hl-5">compactArrays:</span><span class="hl-0"> </span><span class="hl-6">true</span><span class="hl-0"> })</span><br/><span class="hl-5">objBuilder</span><span class="hl-0">.</span><span class="hl-8">add</span><span class="hl-0">([</span><span class="hl-9">2</span><span class="hl-0">], </span><span class="hl-2">&quot;hello world&quot;</span><span class="hl-0">)</span><br/><span class="hl-5">objBuilder</span><span class="hl-0">.</span><span class="hl-5">object</span><span class="hl-0"> === [</span><span class="hl-2">&quot;hello world&quot;</span><span class="hl-0">]</span>
</code><button type="button">Copy</button></pre>

          <a id="sequencetostream-1" class="tsd-anchor"></a>
          <h2 class="tsd-anchor-link">
            SequenceToStream<a
              href="#sequencetostream-1"
              aria-label="Permalink"
              class="tsd-anchor-icon"
              ><svg viewBox="0 0 24 24">
                <use href="assets/icons.svg#icon-anchor"></use></svg
            ></a>
          </h2>
          <p>
            SequenceToStream allows to reconstruct a JSON stream from a
            sequence:
          </p>
          <pre><code class="js"><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">SequenceToStream</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;json-key-value&quot;</span><br/><br/><span class="hl-6">let</span><span class="hl-0"> </span><span class="hl-5">str</span><span class="hl-0"> = </span><span class="hl-2">&quot;&quot;</span><br/><span class="hl-6">const</span><span class="hl-0"> </span><span class="hl-7">decoder</span><span class="hl-0"> = </span><span class="hl-6">new</span><span class="hl-0"> </span><span class="hl-8">TextDecoder</span><span class="hl-0">()</span><br/><span class="hl-6">const</span><span class="hl-0"> </span><span class="hl-7">jsonStreamer</span><span class="hl-0"> = </span><span class="hl-6">new</span><span class="hl-0"> </span><span class="hl-8">SequenceToStream</span><span class="hl-0">({</span><br/><span class="hl-0">  </span><span class="hl-8">onData</span><span class="hl-5">:</span><span class="hl-0"> </span><span class="hl-6">async</span><span class="hl-0"> (</span><span class="hl-5">data</span><span class="hl-0">) </span><span class="hl-6">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-10">// this is normally used for writing to a buffer</span><br/><span class="hl-0">    </span><span class="hl-10">// but in here we are decoding the buffer as js string</span><br/><span class="hl-0">    </span><span class="hl-5">str</span><span class="hl-0"> += </span><span class="hl-5">decoder</span><span class="hl-0">.</span><span class="hl-8">decode</span><span class="hl-0">(</span><span class="hl-5">data</span><span class="hl-0">)</span><br/><span class="hl-0">  },</span><br/><span class="hl-0">})</span><br/><span class="hl-5">jsonStreamer</span><span class="hl-0">.</span><span class="hl-8">add</span><span class="hl-0">([], {}) </span><span class="hl-10">// build initial object</span><br/><span class="hl-5">jsonStreamer</span><span class="hl-0">.</span><span class="hl-8">add</span><span class="hl-0">([</span><span class="hl-2">&quot;hello&quot;</span><span class="hl-0">], </span><span class="hl-2">&quot;world&quot;</span><span class="hl-0">)</span><br/><span class="hl-4">await</span><span class="hl-0"> </span><span class="hl-5">jsonStreamer</span><span class="hl-0">.</span><span class="hl-8">end</span><span class="hl-0">() </span><span class="hl-10">// wait that all pairs are emitted</span><br/><span class="hl-5">str</span><span class="hl-0"> === </span><span class="hl-2">&#39;{&quot;hello&quot;:&quot;world&quot;}&#39;</span>
</code><button type="button">Copy</button></pre>

          <p>
            <em
              >The sequence must be in &quot;depth first&quot; order (with
              ordered indices), otherwise it won't work!</em
            >
            Also notice, the <em>end</em> method must be called after adding all
            the path, value pairs. The implementation forgives if
            &quot;containers&quot; (arrays and objects) are omitted.
          </p>
          <pre><code class="js"><span class="hl-6">let</span><span class="hl-0"> </span><span class="hl-5">str</span><span class="hl-0"> = </span><span class="hl-2">&quot;&quot;</span><br/><span class="hl-6">const</span><span class="hl-0"> </span><span class="hl-7">jsonStreamer</span><span class="hl-0"> = </span><span class="hl-6">new</span><span class="hl-0"> </span><span class="hl-8">SequenceToStream</span><span class="hl-0">({</span><br/><span class="hl-0">  </span><span class="hl-8">onData</span><span class="hl-5">:</span><span class="hl-0"> </span><span class="hl-6">async</span><span class="hl-0"> (</span><span class="hl-5">data</span><span class="hl-0">) </span><span class="hl-6">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-5">str</span><span class="hl-0"> += </span><span class="hl-5">data</span><br/><span class="hl-0">  },</span><br/><span class="hl-0">})</span><br/><span class="hl-5">jsonStreamer</span><span class="hl-0">.</span><span class="hl-8">add</span><span class="hl-0">([</span><span class="hl-2">&quot;hello&quot;</span><span class="hl-0">], </span><span class="hl-2">&quot;world&quot;</span><span class="hl-0">)</span><br/><span class="hl-4">await</span><span class="hl-0"> </span><span class="hl-5">jsonStreamer</span><span class="hl-0">.</span><span class="hl-8">end</span><span class="hl-0">()</span><br/><span class="hl-5">str</span><span class="hl-0"> === </span><span class="hl-2">&#39;{&quot;hello&quot;:&quot;world&quot;}&#39;</span>
</code><button type="button">Copy</button></pre>

          <p>It also fills empty array positions with nulls:</p>
          <pre><code class="js"><span class="hl-6">let</span><span class="hl-0"> </span><span class="hl-5">str</span><span class="hl-0"> = </span><span class="hl-2">&quot;&quot;</span><br/><span class="hl-6">const</span><span class="hl-0"> </span><span class="hl-7">jsonStreamer</span><span class="hl-0"> = </span><span class="hl-6">new</span><span class="hl-0"> </span><span class="hl-8">SequenceToStream</span><span class="hl-0">({</span><br/><span class="hl-0">  </span><span class="hl-8">onData</span><span class="hl-5">:</span><span class="hl-0"> </span><span class="hl-6">async</span><span class="hl-0"> (</span><span class="hl-5">data</span><span class="hl-0">) </span><span class="hl-6">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-5">str</span><span class="hl-0"> += </span><span class="hl-5">data</span><br/><span class="hl-0">  },</span><br/><span class="hl-0">})</span><br/><span class="hl-5">jsonStreamer</span><span class="hl-0">.</span><span class="hl-8">add</span><span class="hl-0">([</span><span class="hl-9">2</span><span class="hl-0">], </span><span class="hl-2">&quot;hello world&quot;</span><span class="hl-0">)</span><br/><span class="hl-4">await</span><span class="hl-0"> </span><span class="hl-5">jsonStreamer</span><span class="hl-0">.</span><span class="hl-8">end</span><span class="hl-0">()</span><br/><span class="hl-5">str</span><span class="hl-0"> === </span><span class="hl-2">&#39;[null,null,&quot;hello world&quot;]&#39;</span>
</code><button type="button">Copy</button></pre>

          <p>Unless the options <code>compactArrays</code> is chosen:</p>
          <pre><code class="js"><span class="hl-6">let</span><span class="hl-0"> </span><span class="hl-5">str</span><span class="hl-0"> = </span><span class="hl-2">&quot;&quot;</span><br/><span class="hl-6">const</span><span class="hl-0"> </span><span class="hl-7">jsonStreamer</span><span class="hl-0"> = </span><span class="hl-6">new</span><span class="hl-0"> </span><span class="hl-8">SequenceToStream</span><span class="hl-0">({</span><br/><span class="hl-0">  </span><span class="hl-8">onData</span><span class="hl-5">:</span><span class="hl-0"> </span><span class="hl-6">async</span><span class="hl-0"> (</span><span class="hl-5">data</span><span class="hl-0">) </span><span class="hl-6">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-5">str</span><span class="hl-0"> += </span><span class="hl-5">data</span><br/><span class="hl-0">  },</span><br/><span class="hl-0">  </span><span class="hl-5">compactArrays:</span><span class="hl-0"> </span><span class="hl-6">true</span><span class="hl-0">,</span><br/><span class="hl-0">})</span><br/><span class="hl-5">jsonStreamer</span><span class="hl-0">.</span><span class="hl-8">add</span><span class="hl-0">([</span><span class="hl-9">2</span><span class="hl-0">], </span><span class="hl-2">&quot;hello world&quot;</span><span class="hl-0">)</span><br/><span class="hl-4">await</span><span class="hl-0"> </span><span class="hl-5">jsonStreamer</span><span class="hl-0">.</span><span class="hl-8">end</span><span class="hl-0">()</span><br/><span class="hl-5">str</span><span class="hl-0"> === </span><span class="hl-2">&#39;[&quot;hello world&quot;]&#39;</span>
</code><button type="button">Copy</button></pre>

          <a id="utilities" class="tsd-anchor"></a>
          <h2 class="tsd-anchor-link">
            Utilities<a
              href="#utilities"
              aria-label="Permalink"
              class="tsd-anchor-icon"
              ><svg viewBox="0 0 24 24">
                <use href="assets/icons.svg#icon-anchor"></use></svg
            ></a>
          </h2>
          <a id="parseincludes" class="tsd-anchor"></a>
          <h3 class="tsd-anchor-link">
            parseIncludes<a
              href="#parseincludes"
              aria-label="Permalink"
              class="tsd-anchor-icon"
              ><svg viewBox="0 0 24 24">
                <use href="assets/icons.svg#icon-anchor"></use></svg
            ></a>
          </h3>
          <p>
            This utility converts a string in a data structure used to filter
            paths. This is used internally but is also exposed to be used for
            debugging, ensure that the include syntax is correct, and reformat
            the includes expression.
          </p>
          <pre><code class="js"><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">parseIncludes</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;json-key-value&quot;</span><br/><br/><span class="hl-6">const</span><span class="hl-0"> </span><span class="hl-7">matcher</span><span class="hl-0"> = </span><span class="hl-8">parseIncludes</span><span class="hl-0">(</span><br/><span class="hl-0">  </span><span class="hl-2">`</span><br/><span class="hl-2">&quot;A&quot;(</span><br/><span class="hl-2">  &quot;B&quot;(</span><br/><span class="hl-2">    &quot;C&quot; # test comment 1</span><br/><span class="hl-2">    &quot;D&quot;</span><br/><span class="hl-2">  ) # test comment 2</span><br/><span class="hl-2">  &quot;E&quot; </span><br/><span class="hl-2">)</span><br/><span class="hl-2">&quot;F&quot;</span><br/><span class="hl-2">`</span><span class="hl-0">,</span><br/><span class="hl-0">) </span><span class="hl-10">// this returns a matcher object</span><br/><br/><span class="hl-5">matcher</span><span class="hl-0">.</span><span class="hl-8">maxLength</span><span class="hl-0">() </span><span class="hl-10">// this is the minimum length of the path to be matched. It cannot be greater than the maxDepth parameter (no matches are possible that way)</span><br/><span class="hl-5">matcher</span><span class="hl-0">.</span><span class="hl-8">doesMatch</span><span class="hl-0">([</span><span class="hl-2">&quot;A&quot;</span><span class="hl-0">, </span><span class="hl-2">&quot;B&quot;</span><span class="hl-0">]) </span><span class="hl-10">// this matches</span><br/><span class="hl-5">matcher</span><span class="hl-0">.</span><span class="hl-8">doesMatch</span><span class="hl-0">([</span><span class="hl-2">&quot;F&quot;</span><span class="hl-0">, </span><span class="hl-2">&quot;B&quot;</span><span class="hl-0">]) </span><span class="hl-10">// this matches</span><br/><span class="hl-5">matcher</span><span class="hl-0">.</span><span class="hl-8">doesMatch</span><span class="hl-0">([</span><span class="hl-2">&quot;X&quot;</span><span class="hl-0">]) </span><span class="hl-10">// this doesn&#39;t match</span><br/><span class="hl-5">matcher</span><span class="hl-0">.</span><span class="hl-8">isExhausted</span><span class="hl-0">() </span><span class="hl-10">// this is now false</span><br/><span class="hl-10">// As no match is possible since A and F have passed</span><br/><br/><span class="hl-5">matcher</span><span class="hl-0">.</span><span class="hl-8">stringify</span><span class="hl-0">() </span><span class="hl-10">// this returns: &quot;&#39;A&#39;(&#39;B&#39;(&#39;C&#39; &#39;D&#39;) &#39;E&#39;) &#39;F&#39;&quot;</span><br/><br/><span class="hl-5">matcher</span><span class="hl-0">.</span><span class="hl-8">stringify</span><span class="hl-0">(</span><span class="hl-2">&quot;  &quot;</span><span class="hl-0">) </span><span class="hl-10">// this returns an nicely indented version (2 spaces indentation)</span>
</code><button type="button">Copy</button></pre>

          <p>
            Note: The compact version of the expression (returned by stringify
            without arguments) has been designed to be passed as query parameter
            minimising the characters encoded (only the spaces), so that
            <code>'A'('B'('C' 'D') 'E') 'F'</code> becomes:
            <code>'A'('B'('C'%20'D')%20'E')%20'F'</code>.
          </p>
          <a id="pathconverter-1" class="tsd-anchor"></a>
          <h3 class="tsd-anchor-link">
            pathConverter<a
              href="#pathconverter-1"
              aria-label="Permalink"
              class="tsd-anchor-icon"
              ><svg viewBox="0 0 24 24">
                <use href="assets/icons.svg#icon-anchor"></use></svg
            ></a>
          </h3>
          <p>
            PathConverter is a utility class that converts paths in strings (and
            vice versa). It is designed to emit strings that can be stored in a
            database and retrieved in lexicographic order.
          </p>
          <pre><code class="js"><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">PathConverter</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;json-key-value&quot;</span><br/><br/><span class="hl-6">const</span><span class="hl-0"> </span><span class="hl-7">separator</span><span class="hl-0"> = </span><span class="hl-2">&quot;//&quot;</span><br/><span class="hl-6">const</span><span class="hl-0"> </span><span class="hl-7">numberPrefix</span><span class="hl-0"> = </span><span class="hl-2">&quot;@@&quot;</span><br/><span class="hl-6">const</span><span class="hl-0"> </span><span class="hl-7">pathConverter</span><span class="hl-0"> = </span><span class="hl-6">new</span><span class="hl-0"> </span><span class="hl-8">PathConverter</span><span class="hl-0">(</span><span class="hl-5">separator</span><span class="hl-0">, </span><span class="hl-5">prefix</span><span class="hl-0">)</span><br/><span class="hl-6">const</span><span class="hl-0"> </span><span class="hl-7">path</span><span class="hl-0"> = [</span><span class="hl-2">&quot;hello&quot;</span><span class="hl-0">, </span><span class="hl-2">&quot;world&quot;</span><span class="hl-0">, </span><span class="hl-9">1</span><span class="hl-0">]</span><br/><span class="hl-6">const</span><span class="hl-0"> </span><span class="hl-7">pathString</span><span class="hl-0"> = </span><span class="hl-5">pathConverter</span><span class="hl-0">.</span><span class="hl-8">pathToString</span><span class="hl-0">(</span><span class="hl-5">path</span><span class="hl-0">) </span><span class="hl-10">// &quot;hello//world//@@A1&quot;</span><br/><span class="hl-5">path</span><span class="hl-0"> === </span><span class="hl-5">pathConverter</span><span class="hl-0">.</span><span class="hl-8">stringToPath</span><span class="hl-0">(</span><span class="hl-5">pathString</span><span class="hl-0">)</span>
</code><button type="button">Copy</button></pre>

          <a id="work-with-the-sequence" class="tsd-anchor"></a>
          <h1 class="tsd-anchor-link">
            Work with the sequence<a
              href="#work-with-the-sequence"
              aria-label="Permalink"
              class="tsd-anchor-icon"
              ><svg viewBox="0 0 24 24">
                <use href="assets/icons.svg#icon-anchor"></use></svg
            ></a>
          </h1>
          <p>
            Both StreamToSequence.iter and ObjectToSequence.iter return an
            iterable of path/value pairs. These can be transformed using a for
            loop, and then converted to an object (SequenceToObject) or a JSON
            stream (SequenceToStream):
          </p>
          <pre><code class="js"><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">SequenceToObject</span><span class="hl-0">, </span><span class="hl-5">ObjectToSequence</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;json-key-value&quot;</span><br/><br/><span class="hl-6">function</span><span class="hl-0"> </span><span class="hl-8">getPricesWithVAT</span><span class="hl-0">(</span><span class="hl-5">obj</span><span class="hl-0">) {</span><br/><span class="hl-0">  </span><span class="hl-6">const</span><span class="hl-0"> </span><span class="hl-7">builder</span><span class="hl-0"> = </span><span class="hl-6">new</span><span class="hl-0"> </span><span class="hl-8">SequenceToObject</span><span class="hl-0">()</span><br/><span class="hl-0">  </span><span class="hl-6">const</span><span class="hl-0"> </span><span class="hl-7">parser</span><span class="hl-0"> = </span><span class="hl-6">new</span><span class="hl-0"> </span><span class="hl-8">ObjectToSequence</span><span class="hl-0">()</span><br/><span class="hl-0">  </span><span class="hl-4">for</span><span class="hl-0"> (</span><span class="hl-6">const</span><span class="hl-0"> [</span><span class="hl-7">path</span><span class="hl-0">, </span><span class="hl-7">value</span><span class="hl-0">] </span><span class="hl-6">of</span><span class="hl-0"> </span><span class="hl-5">parser</span><span class="hl-0">.</span><span class="hl-8">iter</span><span class="hl-0">(</span><span class="hl-5">obj</span><span class="hl-0">)) {</span><br/><span class="hl-0">    </span><span class="hl-4">if</span><span class="hl-0"> (</span><span class="hl-5">path</span><span class="hl-0">[</span><span class="hl-9">0</span><span class="hl-0">] === </span><span class="hl-2">&quot;prices&quot;</span><span class="hl-0">) {</span><br/><span class="hl-0">      </span><span class="hl-5">builder</span><span class="hl-0">.</span><span class="hl-8">add</span><span class="hl-0">(</span><span class="hl-5">path</span><span class="hl-0">.</span><span class="hl-8">slice</span><span class="hl-0">(</span><span class="hl-9">1</span><span class="hl-0">), </span><span class="hl-5">value</span><span class="hl-0"> * </span><span class="hl-9">0.2</span><span class="hl-0">)</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">  }</span><br/><span class="hl-0">  </span><span class="hl-4">return</span><span class="hl-0"> </span><span class="hl-5">builder</span><span class="hl-0">.</span><span class="hl-5">object</span><br/><span class="hl-0">}</span>
</code><button type="button">Copy</button></pre>

          <p>This converts:</p>
          <pre><code class="json"><span class="hl-0">{</span><br/><span class="hl-0">  </span><span class="hl-1">&quot;other data&quot;</span><span class="hl-0">: {},</span><br/><span class="hl-0">  </span><span class="hl-1">&quot;prices&quot;</span><span class="hl-0">: {</span><br/><span class="hl-0">    </span><span class="hl-1">&quot;Subscription 1 month&quot;</span><span class="hl-0">: </span><span class="hl-9">20</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-1">&quot;Subscription 2 month&quot;</span><span class="hl-0">: </span><span class="hl-9">35</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-1">&quot;Subscription 6 month&quot;</span><span class="hl-0">: </span><span class="hl-9">100</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-1">&quot;Subscription 1 year&quot;</span><span class="hl-0">: </span><span class="hl-9">180</span><br/><span class="hl-0">  }</span><br/><span class="hl-0">}</span>
</code><button type="button">Copy</button></pre>

          <p>to:</p>
          <pre><code class="json"><span class="hl-0">{</span><br/><span class="hl-0">  </span><span class="hl-1">&quot;Subscription 1 month&quot;</span><span class="hl-0">: </span><span class="hl-9">24</span><span class="hl-0">,</span><br/><span class="hl-0">  </span><span class="hl-1">&quot;Subscription 2 month&quot;</span><span class="hl-0">: </span><span class="hl-9">42</span><span class="hl-0">,</span><br/><span class="hl-0">  </span><span class="hl-1">&quot;Subscription 6 month&quot;</span><span class="hl-0">: </span><span class="hl-9">120</span><span class="hl-0">,</span><br/><span class="hl-0">  </span><span class="hl-1">&quot;Subscription 1 year&quot;</span><span class="hl-0">: </span><span class="hl-9">216</span><br/><span class="hl-0">}</span>
</code><button type="button">Copy</button></pre>

          <p>
            I suggest
            <a href="https://github.com/iter-tools/iter-tools">iter-tools</a> to
            work with iterables and async iterables.
          </p>
          <a id="includes" class="tsd-anchor"></a>
          <h2 class="tsd-anchor-link">
            Includes<a
              href="#includes"
              aria-label="Permalink"
              class="tsd-anchor-icon"
              ><svg viewBox="0 0 24 24">
                <use href="assets/icons.svg#icon-anchor"></use></svg
            ></a>
          </h2>
          <p>
            The <em>includes</em> parameter can be used on StreamToSequence and
            ObjectToSequence and it allows to only emit pairs with a certain
            path. This is more limited than a simple filter, but it is able to
            figure out when matches are no longer possible so that it is not
            necessary to parse the rest of the JSON. If more complex filtering
            is required, is easy enough to filter the sequence once is emitted.
            This parameter uses a simple and compact expression to perform
            matches. Including:
          </p>
          <ul>
            <li>
              direct match of keys. Using a string enclosed in single or double
              quotes
            </li>
            <li>direct match of array indices. Using a number</li>
            <li>
              a way to match a slice of an array. Using 2 indices separated by 2
              dots: 3..5 (matching index 3 and 4). If the first index is omitted
              is considered 0, if the last is omitted is considered Infinity
            </li>
            <li>
              a convenient * operator that matches any index or key as long as
              there is one
            </li>
            <li>'()' to recursively match on multiple levels</li>
          </ul>
          <p>It is easier to show. Here's the JSON example:</p>
          <pre><code class="json"><span class="hl-0">{</span><br/><span class="hl-0">  </span><span class="hl-1">&quot;products&quot;</span><span class="hl-0">: {</span><br/><span class="hl-0">    </span><span class="hl-1">&quot;123001&quot;</span><span class="hl-0"> : {</span><span class="hl-1">&quot;productName&quot;</span><span class="hl-0">: </span><span class="hl-2">&quot;piano catapult&quot;</span><span class="hl-0">, </span><span class="hl-1">&quot;brand&quot;</span><span class="hl-0">: </span><span class="hl-2">&quot;ACME&quot;</span><span class="hl-0">},</span><br/><span class="hl-0">    </span><span class="hl-1">&quot;456001&quot;</span><span class="hl-0"> : {</span><span class="hl-1">&quot;productName&quot;</span><span class="hl-0">: </span><span class="hl-2">&quot;fake tunnel&quot;</span><span class="hl-0">, </span><span class="hl-1">&quot;brand&quot;</span><span class="hl-0">: </span><span class="hl-2">&quot;ACME&quot;</span><span class="hl-0">},</span><br/><span class="hl-0">    </span><span class="hl-3">...</span><br/><span class="hl-0">  },</span><br/><span class="hl-0">  </span><span class="hl-1">&quot;invoices&quot;</span><span class="hl-0">: [</span><br/><span class="hl-0">    {</span><span class="hl-1">&quot;productCode&quot;</span><span class="hl-0">: </span><span class="hl-2">&quot;123001&quot;</span><span class="hl-0">, </span><span class="hl-1">&quot;itemsSold&quot;</span><span class="hl-0">: </span><span class="hl-9">40</span><span class="hl-0">, </span><span class="hl-1">&quot;unitPrice&quot;</span><span class="hl-0">: </span><span class="hl-9">120</span><span class="hl-0">},</span><br/><span class="hl-0">    {</span><span class="hl-1">&quot;productCode&quot;</span><span class="hl-0">: </span><span class="hl-2">&quot;456001&quot;</span><span class="hl-0">, </span><span class="hl-1">&quot;itemsSold&quot;</span><span class="hl-0">: </span><span class="hl-9">12</span><span class="hl-0">, </span><span class="hl-1">&quot;unitPrice&quot;</span><span class="hl-0">: </span><span class="hl-9">220</span><span class="hl-0">},</span><br/><span class="hl-0">    </span><span class="hl-3">...</span><br/><span class="hl-0">  ]</span><br/><span class="hl-0">}</span>
</code><button type="button">Copy</button></pre>

          <p>We can use this expression:</p>
          <pre><code class="js"><span class="hl-6">const</span><span class="hl-0"> </span><span class="hl-7">includes</span><span class="hl-0"> = </span><span class="hl-2">`</span><br/><span class="hl-2">&#39;invoices&#39;(</span><br/><span class="hl-2">  0..2(</span><br/><span class="hl-2">    &#39;itemsSold&#39;</span><br/><span class="hl-2">    &#39;unitPrice&#39;</span><br/><span class="hl-2">  )</span><br/><span class="hl-2">)</span><br/><span class="hl-2">`</span>
</code><button type="button">Copy</button></pre>

          <p>to get this sequence:</p>
          <pre><code><span class="hl-0">[</span><span class="hl-2">&#39;invoices&#39;</span><span class="hl-0">, </span><span class="hl-9">0</span><span class="hl-0">, </span><span class="hl-2">&#39;itemsSold&#39;</span><span class="hl-0">] </span><span class="hl-9">40</span><br/><span class="hl-0">[</span><span class="hl-2">&#39;invoices&#39;</span><span class="hl-0">, </span><span class="hl-9">0</span><span class="hl-0">, </span><span class="hl-2">&#39;unitPrice&#39;</span><span class="hl-0">] </span><span class="hl-9">120</span><br/><span class="hl-0">[</span><span class="hl-2">&#39;invoices&#39;</span><span class="hl-0">, </span><span class="hl-9">1</span><span class="hl-0">, </span><span class="hl-2">&#39;itemsSold&#39;</span><span class="hl-0">] </span><span class="hl-9">12</span><br/><span class="hl-0">[</span><span class="hl-2">&#39;invoices&#39;</span><span class="hl-0">, </span><span class="hl-9">1</span><span class="hl-0">, </span><span class="hl-2">&#39;unitPrice&#39;</span><span class="hl-0">] </span><span class="hl-9">220</span>
</code><button>Copy</button></pre>

          <p>or</p>
          <pre><code class="js"><span class="hl-6">const</span><span class="hl-0"> </span><span class="hl-7">includes</span><span class="hl-0"> = </span><span class="hl-2">`</span><br/><span class="hl-2">&#39;products&#39;(</span><br/><span class="hl-2">  *(</span><br/><span class="hl-2">    &#39;productName&#39;</span><br/><span class="hl-2">  )</span><br/><span class="hl-2">)</span><br/><span class="hl-2">`</span>
</code><button type="button">Copy</button></pre>

          <p>to get this sequence:</p>
          <pre><code><span class="hl-0">[</span><span class="hl-2">&#39;products&#39;</span><span class="hl-0">, </span><span class="hl-2">&#39;123001&#39;</span><span class="hl-0">, </span><span class="hl-2">&#39;productName&#39;</span><span class="hl-0">] </span><span class="hl-5">piano</span><span class="hl-0"> </span><span class="hl-5">catapult</span><br/><span class="hl-0">[</span><span class="hl-2">&#39;products&#39;</span><span class="hl-0">, </span><span class="hl-2">&#39;456001&#39;</span><span class="hl-0">, </span><span class="hl-2">&#39;productName&#39;</span><span class="hl-0">] </span><span class="hl-5">fake</span><span class="hl-0"> </span><span class="hl-5">tunnel</span>
</code><button>Copy</button></pre>

          <a id="examples" class="tsd-anchor"></a>
          <h1 class="tsd-anchor-link">
            Examples<a
              href="#examples"
              aria-label="Permalink"
              class="tsd-anchor-icon"
              ><svg viewBox="0 0 24 24">
                <use href="assets/icons.svg#icon-anchor"></use></svg
            ></a>
          </h1>
          <a id="filter-a-json-stream" class="tsd-anchor"></a>
          <h2 class="tsd-anchor-link">
            Filter a JSON stream<a
              href="#filter-a-json-stream"
              aria-label="Permalink"
              class="tsd-anchor-icon"
              ><svg viewBox="0 0 24 24">
                <use href="assets/icons.svg#icon-anchor"></use></svg
            ></a>
          </h2>
          <p>
            In this example shows how to filter a JSON using fetch without
            loading it into memory.
          </p>
          <pre><code class="js"><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">StreamToSequence</span><span class="hl-0">, </span><span class="hl-5">SequenceToStream</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;json-key-value&quot;</span><br/><br/><span class="hl-6">async</span><span class="hl-0"> </span><span class="hl-6">function</span><span class="hl-0"> </span><span class="hl-8">filterJSONStream</span><span class="hl-0">(</span><span class="hl-5">readable</span><span class="hl-0">, </span><span class="hl-5">writable</span><span class="hl-0">, </span><span class="hl-5">includes</span><span class="hl-0">, </span><span class="hl-5">controller</span><span class="hl-0">) {</span><br/><span class="hl-0">  </span><span class="hl-6">const</span><span class="hl-0"> </span><span class="hl-7">encoder</span><span class="hl-0"> = </span><span class="hl-6">new</span><span class="hl-0"> </span><span class="hl-8">TextEncoder</span><span class="hl-0">()</span><br/><span class="hl-0">  </span><span class="hl-6">const</span><span class="hl-0"> </span><span class="hl-7">writer</span><span class="hl-0"> = </span><span class="hl-5">writable</span><span class="hl-0">.</span><span class="hl-8">getWriter</span><span class="hl-0">()</span><br/><br/><span class="hl-0">  </span><span class="hl-6">const</span><span class="hl-0"> </span><span class="hl-7">parser</span><span class="hl-0"> = </span><span class="hl-6">new</span><span class="hl-0"> </span><span class="hl-8">StreamToSequence</span><span class="hl-0">({ </span><span class="hl-5">includes</span><span class="hl-0"> })</span><br/><span class="hl-0">  </span><span class="hl-6">const</span><span class="hl-0"> </span><span class="hl-7">builder</span><span class="hl-0"> = </span><span class="hl-6">new</span><span class="hl-0"> </span><span class="hl-8">SequenceToStream</span><span class="hl-0">({</span><br/><span class="hl-0">    </span><span class="hl-8">onData</span><span class="hl-5">:</span><span class="hl-0"> </span><span class="hl-6">async</span><span class="hl-0"> (</span><span class="hl-5">data</span><span class="hl-0">) </span><span class="hl-6">=&gt;</span><span class="hl-0"> </span><span class="hl-5">writer</span><span class="hl-0">.</span><span class="hl-8">write</span><span class="hl-0">(</span><span class="hl-5">data</span><span class="hl-0">),</span><br/><span class="hl-0">  })</span><br/><br/><span class="hl-0">  </span><span class="hl-4">for</span><span class="hl-0"> </span><span class="hl-4">await</span><span class="hl-0"> (</span><span class="hl-6">const</span><span class="hl-0"> </span><span class="hl-7">chunk</span><span class="hl-0"> </span><span class="hl-6">of</span><span class="hl-0"> </span><span class="hl-5">readable</span><span class="hl-0">) {</span><br/><span class="hl-0">    </span><span class="hl-4">if</span><span class="hl-0"> (</span><span class="hl-5">parser</span><span class="hl-0">.</span><span class="hl-8">isExhausted</span><span class="hl-0">()) </span><span class="hl-4">break</span><br/><br/><span class="hl-0">    </span><span class="hl-4">for</span><span class="hl-0"> (</span><span class="hl-6">const</span><span class="hl-0"> [</span><span class="hl-7">path</span><span class="hl-0">, </span><span class="hl-7">value</span><span class="hl-0">] </span><span class="hl-6">of</span><span class="hl-0"> </span><span class="hl-5">parser</span><span class="hl-0">.</span><span class="hl-8">iter</span><span class="hl-0">(</span><span class="hl-5">chunk</span><span class="hl-0">)) {</span><br/><span class="hl-0">      </span><span class="hl-5">builder</span><span class="hl-0">.</span><span class="hl-8">add</span><span class="hl-0">(</span><span class="hl-5">path</span><span class="hl-0">, </span><span class="hl-5">value</span><span class="hl-0">)</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">  }</span><br/><br/><span class="hl-0">  </span><span class="hl-5">controller</span><span class="hl-0">.</span><span class="hl-8">abort</span><span class="hl-0">()</span><br/><span class="hl-0">  </span><span class="hl-4">await</span><span class="hl-0"> </span><span class="hl-5">builder</span><span class="hl-0">.</span><span class="hl-8">end</span><span class="hl-0">()</span><br/><span class="hl-0">}</span><br/><br/><span class="hl-10">// the following function uses fetch to get a JSON</span><br/><span class="hl-10">// it filters the sequence and abort the request after</span><br/><span class="hl-10">// retrieving the data needed by the pathExpression</span><br/><span class="hl-6">async</span><span class="hl-0"> </span><span class="hl-6">function</span><span class="hl-0"> </span><span class="hl-8">fetchAndFilter</span><span class="hl-0">(</span><span class="hl-5">url</span><span class="hl-0">, </span><span class="hl-5">pathExpression</span><span class="hl-0">) {</span><br/><span class="hl-0">  </span><span class="hl-6">const</span><span class="hl-0"> </span><span class="hl-7">controller</span><span class="hl-0"> = </span><span class="hl-6">new</span><span class="hl-0"> </span><span class="hl-8">AbortController</span><span class="hl-0">()</span><br/><span class="hl-0">  </span><span class="hl-6">const</span><span class="hl-0"> </span><span class="hl-7">signal</span><span class="hl-0"> = </span><span class="hl-5">controller</span><span class="hl-0">.</span><span class="hl-5">signal</span><br/><br/><span class="hl-0">  </span><span class="hl-6">let</span><span class="hl-0"> </span><span class="hl-5">response</span><span class="hl-0"> = </span><span class="hl-4">await</span><span class="hl-0"> </span><span class="hl-8">fetch</span><span class="hl-0">(</span><span class="hl-5">url</span><span class="hl-0">, { </span><span class="hl-5">signal</span><span class="hl-0"> })</span><br/><span class="hl-0">  </span><span class="hl-6">let</span><span class="hl-0"> { </span><span class="hl-5">readable</span><span class="hl-0">, </span><span class="hl-5">writable</span><span class="hl-0"> } = </span><span class="hl-6">new</span><span class="hl-0"> </span><span class="hl-8">TransformStream</span><span class="hl-0">()</span><br/><span class="hl-0">  </span><span class="hl-6">let</span><span class="hl-0"> </span><span class="hl-5">newResponse</span><span class="hl-0"> = </span><span class="hl-6">new</span><span class="hl-0"> </span><span class="hl-8">Response</span><span class="hl-0">(</span><span class="hl-5">readable</span><span class="hl-0">, </span><span class="hl-5">response</span><span class="hl-0">)</span><br/><span class="hl-0">  </span><span class="hl-8">filterJSONStream</span><span class="hl-0">(</span><span class="hl-5">response</span><span class="hl-0">.</span><span class="hl-5">body</span><span class="hl-0">, </span><span class="hl-5">writable</span><span class="hl-0">, </span><span class="hl-5">pathExpression</span><span class="hl-0">)</span><br/><span class="hl-0">  </span><span class="hl-4">return</span><span class="hl-0"> </span><span class="hl-5">newResponse</span><br/><span class="hl-0">}</span>
</code><button type="button">Copy</button></pre>

          <a id="filter-a-file-using-a-node-buffer" class="tsd-anchor"></a>
          <h2 class="tsd-anchor-link">
            Filter a file using a node buffer<a
              href="#filter-a-file-using-a-node-buffer"
              aria-label="Permalink"
              class="tsd-anchor-icon"
              ><svg viewBox="0 0 24 24">
                <use href="assets/icons.svg#icon-anchor"></use></svg
            ></a>
          </h2>
          <p>This function read part of a JSON from a file.</p>
          <pre><code class="js"><span class="hl-4">import</span><span class="hl-0"> </span><span class="hl-5">fs</span><span class="hl-0"> </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;fs&quot;</span><br/><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">StreamToSequence</span><span class="hl-0">, </span><span class="hl-5">SequenceToObject</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;json-key-value&quot;</span><br/><br/><span class="hl-6">async</span><span class="hl-0"> </span><span class="hl-6">function</span><span class="hl-0"> </span><span class="hl-8">filterFile</span><span class="hl-0">(</span><span class="hl-5">filename</span><span class="hl-0">, </span><span class="hl-5">includes</span><span class="hl-0">) {</span><br/><span class="hl-0">  </span><span class="hl-6">const</span><span class="hl-0"> </span><span class="hl-7">readStream</span><span class="hl-0"> = </span><span class="hl-5">fs</span><span class="hl-0">.</span><span class="hl-8">createReadStream</span><span class="hl-0">(</span><span class="hl-5">filename</span><span class="hl-0">)</span><br/><span class="hl-0">  </span><span class="hl-6">const</span><span class="hl-0"> </span><span class="hl-7">parser</span><span class="hl-0"> = </span><span class="hl-6">new</span><span class="hl-0"> </span><span class="hl-8">StreamToSequence</span><span class="hl-0">()</span><br/><span class="hl-0">  </span><span class="hl-6">const</span><span class="hl-0"> </span><span class="hl-7">builder</span><span class="hl-0"> = </span><span class="hl-6">new</span><span class="hl-0"> </span><span class="hl-8">SequenceToObject</span><span class="hl-0">()</span><br/><br/><span class="hl-0">  </span><span class="hl-4">for</span><span class="hl-0"> </span><span class="hl-4">await</span><span class="hl-0"> (</span><span class="hl-6">const</span><span class="hl-0"> </span><span class="hl-7">chunk</span><span class="hl-0"> </span><span class="hl-6">of</span><span class="hl-0"> </span><span class="hl-5">readStream</span><span class="hl-0">) {</span><br/><span class="hl-0">    </span><span class="hl-4">if</span><span class="hl-0"> (</span><span class="hl-5">parser</span><span class="hl-0">.</span><span class="hl-8">isExhausted</span><span class="hl-0">()) </span><span class="hl-4">break</span><br/><br/><span class="hl-0">    </span><span class="hl-4">for</span><span class="hl-0"> (</span><span class="hl-6">const</span><span class="hl-0"> [</span><span class="hl-7">path</span><span class="hl-0">, </span><span class="hl-7">value</span><span class="hl-0">] </span><span class="hl-6">of</span><span class="hl-0"> </span><span class="hl-5">parser</span><span class="hl-0">.</span><span class="hl-8">iter</span><span class="hl-0">(</span><span class="hl-5">chunk</span><span class="hl-0">)) {</span><br/><span class="hl-0">      </span><span class="hl-5">builder</span><span class="hl-0">.</span><span class="hl-8">add</span><span class="hl-0">(</span><span class="hl-5">path</span><span class="hl-0">, </span><span class="hl-5">value</span><span class="hl-0">)</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">  }</span><br/><span class="hl-0">  </span><span class="hl-5">readStream</span><span class="hl-0">.</span><span class="hl-8">destroy</span><span class="hl-0">()</span><br/><span class="hl-0">  </span><span class="hl-4">return</span><span class="hl-0"> </span><span class="hl-5">builder</span><span class="hl-0">.</span><span class="hl-5">object</span><br/><span class="hl-0">}</span>
</code><button type="button">Copy</button></pre>

          <a id="streaming-and-non-streaming-parser" class="tsd-anchor"></a>
          <h2 class="tsd-anchor-link">
            Streaming and non streaming parser<a
              href="#streaming-and-non-streaming-parser"
              aria-label="Permalink"
              class="tsd-anchor-icon"
              ><svg viewBox="0 0 24 24">
                <use href="assets/icons.svg#icon-anchor"></use></svg
            ></a>
          </h2>
          <p>
            The library provides 2 ways to get a sequence
            <code>ObjectToSequence</code> and <code>StreamToSequence</code>. You
            can use ObjectToSequence to return a sequence of path, value pairs
            from an object.
          </p>
          <pre><code class="js"><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">ObjectToSequence</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;json-key-value&quot;</span><br/><br/><span class="hl-6">const</span><span class="hl-0"> </span><span class="hl-7">parser</span><span class="hl-0"> = </span><span class="hl-6">new</span><span class="hl-0"> </span><span class="hl-8">ObjectToSequence</span><span class="hl-0">()</span><br/><span class="hl-4">for</span><span class="hl-0"> (</span><span class="hl-6">const</span><span class="hl-0"> [</span><span class="hl-7">path</span><span class="hl-0">, </span><span class="hl-7">value</span><span class="hl-0">] </span><span class="hl-6">of</span><span class="hl-0"> </span><span class="hl-5">parser</span><span class="hl-0">.</span><span class="hl-8">iter</span><span class="hl-0">(</span><span class="hl-5">obj</span><span class="hl-0">)) {</span><br/><span class="hl-0">  </span><span class="hl-10">// ..</span><br/><span class="hl-0">}</span>
</code><button type="button">Copy</button></pre>

          <p>Of course you can easily convert it from a string:</p>
          <pre><code class="js"><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">ObjectToSequence</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;json-key-value&quot;</span><br/><br/><span class="hl-6">const</span><span class="hl-0"> </span><span class="hl-7">parser</span><span class="hl-0"> = </span><span class="hl-6">new</span><span class="hl-0"> </span><span class="hl-8">ObjectToSequence</span><span class="hl-0">()</span><br/><span class="hl-4">for</span><span class="hl-0"> (</span><span class="hl-6">const</span><span class="hl-0"> [</span><span class="hl-7">path</span><span class="hl-0">, </span><span class="hl-7">value</span><span class="hl-0">] </span><span class="hl-6">of</span><span class="hl-0"> </span><span class="hl-5">parser</span><span class="hl-0">.</span><span class="hl-8">iter</span><span class="hl-0">(</span><span class="hl-7">JSON</span><span class="hl-0">.</span><span class="hl-8">parse</span><span class="hl-0">(</span><span class="hl-5">obj</span><span class="hl-0">))) {</span><br/><span class="hl-0">  </span><span class="hl-10">// ..</span><br/><span class="hl-0">}</span>
</code><button type="button">Copy</button></pre>

          <p>
            How does this differ from StreamToSequence? When should we use one
            or the other? StreamToSequence is a streaming parser, so it doesn't
            require to load the entire string in memory to work.
          </p>
          <p>
            From the point of view of raw speed StreamToSequence can be slower
            <em>if used to transform the entire JSON</em> into a sequence
            especially
            <em>if the stream has low latency and high bandwidth</em>.
          </p>
          <p>
            However, using <strong>include</strong> and
            <strong>maxDepth</strong> to filter the JSON can be considerably
            faster and memory efficient. In doubt I suggest to benchmark
            specific cases.
          </p>
          <a id="benchmarks" class="tsd-anchor"></a>
          <h1 class="tsd-anchor-link">
            Benchmarks<a
              href="#benchmarks"
              aria-label="Permalink"
              class="tsd-anchor-icon"
              ><svg viewBox="0 0 24 24">
                <use href="assets/icons.svg#icon-anchor"></use></svg
            ></a>
          </h1>
          <p>
            I have included benchmarks to show how this library can speed up
            extracting data from a JSON. In the examples I am extracting a
            single random record from a JSON with more than 16000 records
            (15MB). As a reference I am comparing to reading the entire file and
            parsing with JSON.parse:
          </p>
          <pre><code><span class="hl-5">$</span><span class="hl-0"> </span><span class="hl-5">node</span><span class="hl-0"> </span><span class="hl-5">benchmarks</span><span class="hl-0">/</span><span class="hl-5">standardFetch</span><span class="hl-0">.</span><span class="hl-5">mjs</span><br/><br/><span class="hl-5">Timings</span><br/><span class="hl-0">=======</span><br/><span class="hl-11">Mean</span><span class="hl-0">:   </span><span class="hl-9">43.39</span><span class="hl-0"> </span><span class="hl-5">ms</span><br/><span class="hl-11">Median</span><span class="hl-0">: </span><span class="hl-9">41.757</span><span class="hl-0"> </span><span class="hl-5">ms</span><br/><br/><span class="hl-5">Heap</span><br/><span class="hl-0">====</span><br/><span class="hl-11">Mean</span><span class="hl-0">:   </span><span class="hl-9">65</span><span class="hl-0">,</span><span class="hl-9">447.201</span><span class="hl-0"> </span><span class="hl-7">KB</span><br/><span class="hl-11">Median</span><span class="hl-0">: </span><span class="hl-9">65</span><span class="hl-0">,</span><span class="hl-9">295.816</span><span class="hl-0"> </span><span class="hl-7">KB</span>
</code><button>Copy</button></pre>

          <p>
            JSON.parse is really fast! But reading the entire file is really
            problematic from the point of view of memory management.
          </p>
          <p>
            Here's how it works using StreamToSequence streaming parser with
            maxDepth and includes:
          </p>
          <pre><code><span class="hl-5">$</span><span class="hl-0"> </span><span class="hl-5">node</span><span class="hl-0"> </span><span class="hl-5">benchmarks</span><span class="hl-0">/</span><span class="hl-5">efficientFetch</span><span class="hl-0">.</span><span class="hl-5">mjs</span><br/><br/><span class="hl-5">Timings</span><br/><span class="hl-0">=======</span><br/><span class="hl-11">Mean</span><span class="hl-0">:   </span><span class="hl-9">29.934</span><span class="hl-0"> </span><span class="hl-5">ms</span><br/><span class="hl-11">Median</span><span class="hl-0">: </span><span class="hl-9">28.89</span><span class="hl-0"> </span><span class="hl-5">ms</span><br/><br/><span class="hl-5">Heap</span><br/><span class="hl-0">====</span><br/><span class="hl-11">Mean</span><span class="hl-0">:   </span><span class="hl-9">6</span><span class="hl-0">,</span><span class="hl-9">138.229</span><span class="hl-0"> </span><span class="hl-7">KB</span><br/><span class="hl-11">Median</span><span class="hl-0">: </span><span class="hl-9">5</span><span class="hl-0">,</span><span class="hl-9">955.203</span><span class="hl-0"> </span><span class="hl-7">KB</span>
</code><button>Copy</button></pre>

          <p>
            It is a little bit faster (not having to read the entire file every
            time). But also much more memory efficient.
          </p>
          <p>
            I have created a version that creates an index of the JSON file. So
            that it can be stored and records can be accessed directly:
          </p>
          <pre><code><span class="hl-5">$</span><span class="hl-0"> </span><span class="hl-5">node</span><span class="hl-0"> </span><span class="hl-5">benchmarks</span><span class="hl-0">/</span><span class="hl-5">indexedFetch</span><span class="hl-0">.</span><span class="hl-5">mjs</span><br/><br/><span class="hl-5">Timings</span><br/><span class="hl-0">=======</span><br/><span class="hl-11">Mean</span><span class="hl-0">:   </span><span class="hl-9">1.609</span><span class="hl-0"> </span><span class="hl-5">ms</span><br/><span class="hl-11">Median</span><span class="hl-0">: </span><span class="hl-9">1.484</span><span class="hl-0"> </span><span class="hl-5">ms</span><br/><br/><span class="hl-5">Heap</span><br/><span class="hl-0">====</span><br/><span class="hl-11">Mean</span><span class="hl-0">:   </span><span class="hl-9">8</span><span class="hl-0">,</span><span class="hl-9">400.1</span><span class="hl-0"> </span><span class="hl-7">KB</span><br/><span class="hl-11">Median</span><span class="hl-0">: </span><span class="hl-9">8</span><span class="hl-0">,</span><span class="hl-9">351.094</span><span class="hl-0"> </span><span class="hl-7">KB</span>
</code><button>Copy</button></pre>

          <p>Which is 28 times faster than the out-of-the-box JSON.parse!</p>
          <a id="how-streamtosequence-is-optimized" class="tsd-anchor"></a>
          <h1 class="tsd-anchor-link">
            How StreamToSequence is optimized<a
              href="#how-streamtosequence-is-optimized"
              aria-label="Permalink"
              class="tsd-anchor-icon"
              ><svg viewBox="0 0 24 24">
                <use href="assets/icons.svg#icon-anchor"></use></svg
            ></a>
          </h1>
          <p>
            StreamToSequence reaches very good performance thanks to 2
            optimizations:
          </p>
          <ul>
            <li>
              <strong>No need to read the entire stream</strong>: once the data
              specified by <strong>include</strong> are found, the stream can be
              aborted. The performance improvement increases with the latency of
              the stream.
            </li>
            <li>
              <strong>Minimize encoding and parsing</strong>: Encoding the
              buffer from UTF8 to a JS strings and parsing JSON values can take
              a considerable amount of resources. StreamToSequence works with
              buffers, encoding and parsing only the path and values that needs
              to be yielded. <strong>maxDepth</strong> and
              <strong>include</strong> both helps minimizing those.
            </li>
          </ul>
        </div>
      </div>
      <div class="col-sidebar">
        <div class="page-menu">
          <div class="tsd-navigation settings">
            <details class="tsd-accordion">
              <summary class="tsd-accordion-summary">
                <h3>
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                    <use href="assets/icons.svg#icon-chevronDown"></use></svg
                  >Settings
                </h3>
              </summary>
              <div class="tsd-accordion-details">
                <div class="tsd-filter-visibility">
                  <span class="settings-label">Member Visibility</span>
                  <ul id="tsd-filter-options">
                    <li class="tsd-filter-item">
                      <label class="tsd-filter-input"
                        ><input
                          type="checkbox"
                          id="tsd-filter-protected"
                          name="protected"
                        /><svg
                          width="32"
                          height="32"
                          viewBox="0 0 32 32"
                          aria-hidden="true"
                        >
                          <rect
                            class="tsd-checkbox-background"
                            width="30"
                            height="30"
                            x="1"
                            y="1"
                            rx="6"
                            fill="none"
                          ></rect>
                          <path
                            class="tsd-checkbox-checkmark"
                            d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25"
                            stroke="none"
                            stroke-width="3.5"
                            stroke-linejoin="round"
                            fill="none"
                          ></path></svg
                        ><span>Protected</span></label
                      >
                    </li>
                    <li class="tsd-filter-item">
                      <label class="tsd-filter-input"
                        ><input
                          type="checkbox"
                          id="tsd-filter-inherited"
                          name="inherited"
                          checked
                        /><svg
                          width="32"
                          height="32"
                          viewBox="0 0 32 32"
                          aria-hidden="true"
                        >
                          <rect
                            class="tsd-checkbox-background"
                            width="30"
                            height="30"
                            x="1"
                            y="1"
                            rx="6"
                            fill="none"
                          ></rect>
                          <path
                            class="tsd-checkbox-checkmark"
                            d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25"
                            stroke="none"
                            stroke-width="3.5"
                            stroke-linejoin="round"
                            fill="none"
                          ></path></svg
                        ><span>Inherited</span></label
                      >
                    </li>
                    <li class="tsd-filter-item">
                      <label class="tsd-filter-input"
                        ><input
                          type="checkbox"
                          id="tsd-filter-external"
                          name="external"
                        /><svg
                          width="32"
                          height="32"
                          viewBox="0 0 32 32"
                          aria-hidden="true"
                        >
                          <rect
                            class="tsd-checkbox-background"
                            width="30"
                            height="30"
                            x="1"
                            y="1"
                            rx="6"
                            fill="none"
                          ></rect>
                          <path
                            class="tsd-checkbox-checkmark"
                            d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25"
                            stroke="none"
                            stroke-width="3.5"
                            stroke-linejoin="round"
                            fill="none"
                          ></path></svg
                        ><span>External</span></label
                      >
                    </li>
                  </ul>
                </div>
                <div class="tsd-theme-toggle">
                  <label class="settings-label" for="tsd-theme">Theme</label
                  ><select id="tsd-theme">
                    <option value="os">OS</option>
                    <option value="light">Light</option>
                    <option value="dark">Dark</option>
                  </select>
                </div>
              </div>
            </details>
          </div>
          <details open class="tsd-accordion tsd-page-navigation">
            <summary class="tsd-accordion-summary">
              <h3>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                  <use href="assets/icons.svg#icon-chevronDown"></use></svg
                >On This Page
              </h3>
            </summary>
            <div class="tsd-accordion-details">
              <a href="#json-key-value"
                ><span>json-<wbr />key-<wbr />value</span></a
              >
              <ul>
                <li>
                  <a href="#the-idea"><span>The idea</span></a>
                </li>
                <li>
                  <a href="#about-the-ordering"
                    ><span>About the ordering</span></a
                  >
                </li>
                <li>
                  <a href="#example-use-cases"
                    ><span>Example use cases</span></a
                  >
                </li>
                <li>
                  <ul>
                    <li>
                      <a href="#rendering-partial-state"
                        ><span>Rendering partial state</span></a
                      >
                    </li>
                    <li>
                      <a href="#filter-data"><span>Filter data</span></a>
                    </li>
                    <li>
                      <a href="#easy-data-manipulation"
                        ><span>Easy <wbr />Data manipulation</span></a
                      >
                    </li>
                  </ul>
                </li>
              </ul>
              <a href="#api"><span>API</span></a>
              <ul>
                <li>
                  <a href="#streamtosequence-1"
                    ><span>Stream<wbr />To<wbr />Sequence</span></a
                  >
                </li>
                <li>
                  <ul>
                    <li>
                      <a href="#partial-parsing"
                        ><span>Partial parsing</span></a
                      >
                    </li>
                    <li>
                      <a href="#buffer-position"
                        ><span>Buffer position</span></a
                      >
                    </li>
                  </ul>
                </li>
                <li>
                  <a href="#objecttosequence-1"
                    ><span>Object<wbr />To<wbr />Sequence</span></a
                  >
                </li>
                <li>
                  <a href="#sequencetoobject-1"
                    ><span>Sequence<wbr />To<wbr />Object</span></a
                  >
                </li>
                <li>
                  <a href="#sequencetostream-1"
                    ><span>Sequence<wbr />To<wbr />Stream</span></a
                  >
                </li>
                <li>
                  <a href="#utilities"><span>Utilities</span></a>
                </li>
                <li>
                  <ul>
                    <li>
                      <a href="#parseincludes"
                        ><span>parse<wbr />Includes</span></a
                      >
                    </li>
                    <li>
                      <a href="#pathconverter-1"
                        ><span>path<wbr />Converter</span></a
                      >
                    </li>
                  </ul>
                </li>
              </ul>
              <a href="#work-with-the-sequence"
                ><span>Work with the sequence</span></a
              >
              <ul>
                <li>
                  <a href="#includes"><span>Includes</span></a>
                </li>
              </ul>
              <a href="#examples"><span>Examples</span></a>
              <ul>
                <li>
                  <a href="#filter-a-json-stream"
                    ><span>Filter a JSON stream</span></a
                  >
                </li>
                <li>
                  <a href="#filter-a-file-using-a-node-buffer"
                    ><span>Filter a file using a node buffer</span></a
                  >
                </li>
                <li>
                  <a href="#streaming-and-non-streaming-parser"
                    ><span>Streaming and non streaming parser</span></a
                  >
                </li>
              </ul>
              <a href="#benchmarks"><span>Benchmarks</span></a
              ><a href="#how-streamtosequence-is-optimized"
                ><span
                  >How <wbr />Stream<wbr />To<wbr />Sequence is optimized</span
                ></a
              >
            </div>
          </details>
        </div>
        <div class="site-menu">
          <nav class="tsd-navigation">
            <a href="modules.html">json-key-value</a>
            <ul class="tsd-small-nested-navigation" id="tsd-nav-container">
              <li>Loading...</li>
            </ul>
          </nav>
        </div>
      </div>
    </div>
    <footer>
      <p class="tsd-generator">
        Generated using
        <a href="https://typedoc.org/" target="_blank">TypeDoc</a>
      </p>
    </footer>
    <div class="overlay"></div>
  </body>
</html>
