<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: SequenceToObject.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: SequenceToObject.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>//@ts-check

/**
 * @typedef {module:baseTypes.JSONSegmentPathType} JSONSegmentPathType
 * @typedef {import("./baseTypes").JSONValueType} JSONValueType
 * @typedef {import("./baseTypes").JSONPathType} JSONPathType
 */

/**
 * @package
 * @private
 * @param {JSONSegmentPathType} pathSegment
 * @returns {{}|[]}
 */
function initObject(pathSegment) {
  return typeof pathSegment === "number" &amp;&amp; pathSegment >= 0 ? [] : {}
}

/**
 * Convert a sequence to a js object
 */
class SequenceToObject {
  /**
   * Convert a sequence to a js object
   * @param {Object} options
   * @param {boolean} [options.compactArrays=false] - if true ignore array index and generates arrays without gaps
   */
  constructor(options = {}) {
    const { compactArrays } = options
    this.object = undefined
    this.compactArrays = compactArrays ?? false

    this.lastArray = undefined
    this.lastArrayIndex = undefined
  }

  /**
   * @package
   * @private
   * @param {JSONSegmentPathType} pathSegment
   * @param {JSONValueType} currentObject
   * @returns {JSONSegmentPathType}
   */
  _calculateRealIndex(pathSegment, currentObject) {
    if (typeof pathSegment === "string" || !this.compactArrays) {
      return pathSegment
    }
    if (Array.isArray(currentObject)) {
      // copy values locally
      const lastArray = this.lastArray
      const lastArrayIndex = this.lastArrayIndex
      // update with new values
      this.lastArray = currentObject
      this.lastArrayIndex = pathSegment
      if (currentObject === lastArray &amp;&amp; lastArrayIndex === pathSegment) {
        return currentObject.length - 1
      }
      return currentObject.length
    }
    return 0
  }

  /**
   * Returns the object built out of the sequence
   * It can be called multiple times and it will return the up to date object
   * @returns {any}
   */
  getObject() {
    return this.object
  }

  /**
   * Update the object with a new path value pairs
   * @param {JSONPathType} path - an array of path segments
   * @param {JSONValueType} value - the value corresponding to the path
   * @returns {void}
   */
  add(path, value) {
    if (path.length === 0) {
      this.object = value
      return
    }
    if (this.object === undefined) {
      this.object = initObject(path[0])
    }
    let currentObject = this.object
    for (let i = 0; i &lt; path.length - 1; i++) {
      // ignoring type errors here:
      // if path is inconsistent with data, it should throw an exception
      const currentPathSegment = this._calculateRealIndex(
        path[i],
        currentObject,
      )
      const nextPathSegment = path[i + 1]
      // @ts-ignore
      if (currentObject[currentPathSegment] === undefined) {
        // @ts-ignore
        currentObject[currentPathSegment] = initObject(nextPathSegment)
      }
      // @ts-ignore
      currentObject = currentObject[currentPathSegment]
    }
    // @ts-ignore
    const currentPathSegment = this._calculateRealIndex(
      path[path.length - 1],
      currentObject,
    )
    // @ts-ignore
    currentObject[currentPathSegment] = value
  }
}
export default SequenceToObject
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="BaseMatcher.html">BaseMatcher</a></li><li><a href="MatcherContainer.html">MatcherContainer</a></li><li><a href="ObjectToSequence.html">ObjectToSequence</a></li><li><a href="PathConverter.html">PathConverter</a></li><li><a href="SequenceToObject.html">SequenceToObject</a></li><li><a href="SequenceToStream.html">SequenceToStream</a></li><li><a href="StreamToSequence.html">StreamToSequence</a></li></ul><h3>Global</h3><ul><li><a href="global.html#parseIncludes">parseIncludes</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Sun Jan 12 2025 17:48:03 GMT+0000 (Greenwich Mean Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
